<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Google Login Demo</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

  <!-- Login title -->
  <h2 id="login-title">Login with Google</h2>

  <!-- Google Sign-In Button -->
  <div id="google-signin-button"></div>

  <!-- Hidden "home" message -->
  <div id="home-message" style="display: none;">
    <h1>Welcome Home!</h1>
    <p id="user-email"></p>
  </div>

  <script>
    let googleClientId = "";

    // Fetch the client ID from Django backend
    fetch("http://localhost:8000/api/auth/google/client-id/")
      .then(response => response.json())
      .then(data => {
        googleClientId = data.client_id;

        // Initialize Google login
        google.accounts.id.initialize({
          client_id: googleClientId,
          callback: handleCredentialResponse
        });

        google.accounts.id.renderButton(
          document.getElementById("google-signin-button"),
          { theme: "outline", size: "large" }
        );
      })
      .catch(error => {
        console.error("Error loading Google Sign-In:", error);
        alert("Could not load Google Sign-In");
      });

    // Handle Google token response
    function handleCredentialResponse(response) {
      const id_token = response.credential;

      console.log("Google ID token:", id_token);

      // Send token to Django backend
      fetch("http://localhost:8000/api/auth/google/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ access_token: id_token })
      })
      .then(res => res.json())
      .then(data => {
        if (data && data.user) {
          // Hide login elements
          document.getElementById("google-signin-button").style.display = "none";
          document.getElementById("login-title").style.display = "none";

          // Show welcome message
          document.getElementById("home-message").style.display = "block";
          document.getElementById("user-email").textContent = "You are logged in as: " + data.user.email;
        } else {
          alert("Login failed. No user data returned.");
        }
      })
      .catch(err => {
        console.error("Login failed:", err);
        alert("Login failed. See console for details.");
      });
    }
  </script>

</body>
</html>
